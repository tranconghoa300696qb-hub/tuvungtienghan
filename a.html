<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giao diá»‡n EPS TOPIK (CÃ³ Audio & TTS) - OBS</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3b82f6;
            --correct-color: #22c55e;
            --wrong-color: #ef4444;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-color: #1f2937;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Noto Sans KR', 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .obs-container {
            width: 1280px;
            height: 720px;
            background-color: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            padding: 40px;
            position: relative;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 15px;
        }

        .question-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            background: #e0f2fe;
            padding: 8px 20px;
            border-radius: 10px;
        }

        .timer {
            font-size: 32px;
            font-weight: 700;
            color: #d97706;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Content Layout */
        .content-area {
            flex: 1;
            display: flex;
            gap: 40px;
            overflow: hidden; /* TrÃ¡nh trÃ n layout */
        }

        /* Left Column */
        .question-col {
            flex: 1.3;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto; /* Cho phÃ©p cuá»™n náº¿u Ä‘á» quÃ¡ dÃ i */
            padding-right: 10px;
        }

        .question-header {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .question-text {
            font-size: 24px;
            line-height: 1.5;
            font-weight: 500;
            flex: 1;
        }

        /* NÃºt Ä‘á»c TTS */
        .tts-btn {
            background: #8b5cf6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: transform 0.2s;
            flex-shrink: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .tts-btn:hover { transform: scale(1.1); background: #7c3aed; }
        .tts-btn:active { transform: scale(0.95); }

        /* TrÃ¬nh phÃ¡t Audio MP3 */
        .audio-player-container {
            width: 100%;
            background: #f1f5f9;
            padding: 10px;
            border-radius: 10px;
            display: none; /* Máº·c Ä‘á»‹nh áº©n */
            border: 1px solid #cbd5e1;
        }
        
        audio {
            width: 100%;
            height: 40px;
        }

        .question-image {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border: 2px dashed #d1d5db;
            border-radius: 10px;
            display: none;
        }

        /* Right Column */
        .options-col {
            flex: 0.7;
            display: flex;
            flex-direction: column;
            gap: 12px;
            justify-content: center;
        }

        .option-btn {
            background: #f9fafb;
            border: 2px solid #d1d5db;
            border-radius: 12px;
            padding: 18px;
            font-size: 22px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Noto Sans KR', sans-serif;
            position: relative;
        }

        .option-btn:hover { border-color: var(--primary-color); background: #eff6ff; }

        .option-btn.correct {
            background-color: #dcfce7 !important;
            border-color: var(--correct-color) !important;
            color: #14532d;
            font-weight: bold;
        }

        .option-btn.wrong {
            background-color: #fee2e2 !important;
            border-color: var(--wrong-color) !important;
            color: #7f1d1d;
        }

        .option-index {
            display: inline-block;
            width: 30px;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Controls */
        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-btns { display: flex; gap: 15px; }

        .btn {
            padding: 10px 24px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }

        .btn-prev { background: #9ca3af; color: white; }
        .btn-next { background: var(--primary-color); color: white; }
        .btn-next:hover { background: #2563eb; }

        /* Giáº£i thÃ­ch */
        .explanation-box {
            margin-top: 10px;
            padding: 15px;
            background: #fffbeb;
            border-left: 5px solid #f59e0b;
            font-size: 18px;
            display: none;
            border-radius: 0 8px 8px 0;
        }

    </style>
</head>
<body>

    <div class="obs-container">
        <div class="header">
            <div class="question-number" id="q-number">CÃ¢u 1</div>
            <div class="timer" id="timer">â³ 00:30</div>
        </div>

        <div class="content-area">
            <div class="question-col">
                <div class="question-header">
                    <div class="question-text" id="q-text">Loading...</div>
                    <button class="tts-btn" id="tts-btn" onclick="speakQuestion()" title="Äá»c cÃ¢u há»i">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>

                <div class="audio-player-container" id="audio-container">
                    <audio id="audio-player" controls>
                        <source src="" type="audio/mpeg">
                        TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ tháº» audio.
                    </audio>
                </div>

                <img src="" id="q-image" class="question-image" alt="Question Image">
                
                <div class="explanation-box" id="explanation">
                    <strong>ğŸ’¡ Giáº£i thÃ­ch:</strong> <span id="explain-text"></span>
                </div>
            </div>

            <div class="options-col" id="options-container"></div>
        </div>

        <div class="controls">
            <div style="color: #6b7280; font-style: italic;">PhÃ­m táº¯t: â¬… (LÃ¹i) | â¡ (Tiáº¿p)</div>
            <div class="nav-btns">
                <button class="btn btn-prev" onclick="prevQuestion()">LÃ¹i láº¡i</button>
                <button class="btn btn-next" onclick="nextQuestion()">Tiáº¿p theo â¡</button>
            </div>
        </div>
    </div>

    <script>
        // --- Dá»® LIá»†U CÃ‚U Há»I ---
        const examData = [
            {
                id: 1,
                type: "reading", // 'reading' hoáº·c 'listening'
                question: "ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ê°€ì¥ ì•Œë§ì€ ê²ƒì„ ê³ ë¥´ì‹­ì‹œì˜¤.",
                audioFile: "", // KhÃ´ng cÃ³ file nghe
                image: "", 
                options: ["ê°€ë‹¤", "ì˜¤ë‹¤", "ë¨¹ë‹¤", "ìë‹¤"],
                correct: 0,
                explanation: "Chá»n 'ê°€ë‹¤' (Äi) lÃ  phÃ¹ há»£p nháº¥t."
            },
            {
                id: 2,
                type: "listening", // CÃ¢u há»i nghe
                question: "ë‹¤ìŒì„ ë“£ê³  ì•Œë§ì€ ëŒ€ë‹µì„ ê³ ë¥´ì‹­ì‹œì˜¤. (Nghe vÃ  chá»n cÃ¢u tráº£ lá»i Ä‘Ãºng)",
                audioFile: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3", // Link file MP3 (Demo online)
                image: "https://via.placeholder.com/600x300?text=Listening+Question",
                options: ["ë„¤, ì•Œê² ìŠµë‹ˆë‹¤.", "ì•„ë‹ˆìš”, ì—†ìŠµë‹ˆë‹¤.", "ë°˜ê°‘ìŠµë‹ˆë‹¤.", "ì•ˆë…•íˆ ê°€ì„¸ìš”."],
                correct: 2,
                explanation: "NgÆ°á»i nÃ³i chÃ o há»i nÃªn Ä‘Ã¡p láº¡i lÃ  'ë°˜ê°‘ìŠµë‹ˆë‹¤' (Ráº¥t vui Ä‘Æ°á»£c gáº·p)."
            },
            {
                id: 3,
                type: "reading",
                question: "ë‹¤ìŒ í‘œì§€íŒì˜ ëœ»ì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?",
                questionKorean: "ë‹¤ìŒ í‘œì§€íŒì˜ ëœ»ì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?", // Chá»‰ Ä‘á»‹nh vÄƒn báº£n tiáº¿ng HÃ n Ä‘á»ƒ mÃ¡y Ä‘á»c (náº¿u question cÃ³ cáº£ tiáº¿ng Viá»‡t)
                audioFile: "",
                image: "https://via.placeholder.com/600x300?text=No+Smoking",
                options: ["ê¸ˆì—°", "ì£¼ì°¨ê¸ˆì§€", "ì†ì”»ê¸°", "ì •ìˆ™"],
                correct: 0,
                explanation: "Biá»ƒn bÃ¡o cáº¥m hÃºt thuá»‘c lÃ  'ê¸ˆì—°'."
            }
        ];

        // --- Cáº¤U HÃŒNH ---
        let currentIdx = 0;
        let timeLeft = 30;
        let timerInterval;
        let answered = false;

        // Elements
        const els = {
            num: document.getElementById('q-number'),
            text: document.getElementById('q-text'),
            image: document.getElementById('q-image'),
            options: document.getElementById('options-container'),
            timer: document.getElementById('timer'),
            expBox: document.getElementById('explanation'),
            expText: document.getElementById('explain-text'),
            ttsBtn: document.getElementById('tts-btn'),
            audioContainer: document.getElementById('audio-container'),
            audioPlayer: document.getElementById('audio-player')
        };

        function loadQuestion(index) {
            // Reset
            clearInterval(timerInterval);
            timeLeft = 30;
            updateTimerDisplay();
            startTimer();
            answered = false;
            els.expBox.style.display = 'none';
            
            // Dá»«ng audio cÅ© náº¿u Ä‘ang phÃ¡t
            els.audioPlayer.pause();
            els.audioPlayer.currentTime = 0;

            const data = examData[index];
            els.num.textContent = `CÃ¢u ${index + 1} / ${examData.length}`;
            els.text.innerHTML = data.question.replace(/\n/g, "<br>");

            // Xá»­ lÃ½ Audio / TTS
            if (data.type === 'listening' && data.audioFile) {
                // Cháº¿ Ä‘á»™ NGHE
                els.ttsBtn.style.display = 'none'; // áº¨n nÃºt Ä‘á»c
                els.audioContainer.style.display = 'block'; // Hiá»‡n trÃ¬nh phÃ¡t nháº¡c
                els.audioPlayer.src = data.audioFile;
                // els.audioPlayer.play(); // Bá» comment náº¿u muá»‘n tá»± Ä‘á»™ng phÃ¡t
            } else {
                // Cháº¿ Ä‘á»™ Äá»ŒC
                els.ttsBtn.style.display = 'flex'; // Hiá»‡n nÃºt Ä‘á»c
                els.audioContainer.style.display = 'none'; // áº¨n trÃ¬nh phÃ¡t nháº¡c
            }

            // Xá»­ lÃ½ áº¢nh
            if(data.image) {
                els.image.src = data.image;
                els.image.style.display = 'block';
            } else {
                els.image.style.display = 'none';
            }

            // Táº¡o Ä‘Ã¡p Ã¡n
            els.options.innerHTML = '';
            data.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `<span class="option-index">${i+1}</span> ${opt}`;
                btn.onclick = () => checkAnswer(i, btn);
                els.options.appendChild(btn);
            });
        }

        // --- HÃ€M Äá»ŒC TIáº¾NG HÃ€N (TTS) ---
        function speakQuestion() {
            const data = examData[currentIdx];
            // Æ¯u tiÃªn Ä‘á»c trÆ°á»ng 'questionKorean' náº¿u cÃ³, khÃ´ng thÃ¬ Ä‘á»c 'question'
            const textToRead = data.questionKorean || data.question;

            // XÃ³a cÃ¡c lá»‡nh Ä‘á»c cÅ© Ä‘á»ƒ trÃ¡nh bá»‹ chá»“ng chÃ©o
            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(textToRead);
            utterance.lang = 'ko-KR'; // MÃ£ ngÃ´n ngá»¯ tiáº¿ng HÃ n
            utterance.rate = 0.9; // Tá»‘c Ä‘á»™ Ä‘á»c (0.1 -> 10), 0.9 lÃ  vá»«a
            utterance.pitch = 1;  // TÃ´ng giá»ng

            window.speechSynthesis.speak(utterance);
        }

        function checkAnswer(selectedIndex, btnElement) {
            if (answered) return;
            answered = true;
            clearInterval(timerInterval);

            const correctIndex = examData[currentIdx].correct;
            const allBtns = document.querySelectorAll('.option-btn');

            if (selectedIndex === correctIndex) {
                btnElement.classList.add('correct');
            } else {
                btnElement.classList.add('wrong');
                allBtns[correctIndex].classList.add('correct');
            }

            els.expText.textContent = examData[currentIdx].explanation;
            els.expBox.style.display = 'block';
        }

        function nextQuestion() {
            if (currentIdx < examData.length - 1) {
                currentIdx++;
                loadQuestion(currentIdx);
            }
        }

        function prevQuestion() {
            if (currentIdx > 0) {
                currentIdx--;
                loadQuestion(currentIdx);
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    els.timer.textContent = "â° Háº¿t giá»!";
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            els.timer.textContent = `â³ 00:${timeLeft < 10 ? '0'+timeLeft : timeLeft}`;
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if(e.key === "ArrowRight") nextQuestion();
            if(e.key === "ArrowLeft") prevQuestion();
            // PhÃ­m Space Ä‘á»ƒ nghe láº¡i (náº¿u lÃ  bÃ i nghe) hoáº·c Ä‘á»c cÃ¢u há»i
            if(e.key === " ") {
                e.preventDefault(); // TrÃ¡nh trÃ´i trang
                const data = examData[currentIdx];
                if(data.type === 'listening') {
                    if(els.audioPlayer.paused) els.audioPlayer.play();
                    else els.audioPlayer.pause();
                } else {
                    speakQuestion();
                }
            }
        });

        // Init
        loadQuestion(0);

    </script>
</body>
</html>